# Claude Monitor â€” äº§å“éœ€æ±‚æ–‡æ¡£

## ä¸€å¥è¯æè¿°

ç»ˆç«¯çœ‹æ¿å·¥å…·ï¼Œå®æ—¶ç›‘æ§ Claude Code agent çš„ä»»åŠ¡è¿›åº¦å’ŒçŠ¶æ€ã€‚é»‘å®¢é£æ ¼ TUIã€‚

## èƒŒæ™¯ä¸é—®é¢˜

### ç—›ç‚¹

1. **ä»»åŠ¡ä¸å¯è§**ï¼šClaude Code ç”¨ `TaskCreate` / `TodoWrite` åˆ›å»ºä»»åŠ¡åï¼Œç”¨æˆ·æ‰¾ä¸åˆ°è¿™äº›æ•°æ®â€”â€”æ–‡ä»¶åæ˜¯ UUIDï¼Œåˆ†æ•£åœ¨ `~/.claude/todos/` å’Œ `~/.claude/tasks/` ä¸¤å¥—ç³»ç»Ÿä¸­
2. **è¿›åº¦ä¸é€æ˜**ï¼šå¤š agent å¹¶è¡Œå¼€å‘æ—¶ï¼ˆworktree æ¨¡å¼ï¼‰ï¼Œä¸» agent æ— æ³•ç›´è§‚çœ‹åˆ°å„ stream çš„æ‰§è¡ŒçŠ¶å†µ
3. **å†å²ä¸¢å¤±**ï¼šsession ç»“æŸåï¼Œä¹‹å‰çš„ä»»åŠ¡åˆ—è¡¨å°±ã€Œæ¶ˆå¤±ã€äº†ï¼Œæ— æ³•å›é¡¾
4. **åˆ é™¤å³æ¶ˆå¤±**ï¼šClaude Code åˆ é™¤/å®Œæˆ task åï¼ŒJSON æ–‡ä»¶è¢«æ¸…ç†ï¼Œå†å²è®°å½•æ— æ³•è¿½æº¯

### ç›®æ ‡ç”¨æˆ·

- ä½¿ç”¨ Claude Code è¿›è¡Œæ—¥å¸¸å¼€å‘çš„å·¥ç¨‹å¸ˆ
- ä½¿ç”¨ multi-agent / worktree å¹¶è¡Œå¼€å‘æ¨¡å¼çš„ç”¨æˆ·
- å¸Œæœ›å¯¹ AI agent æ‰§è¡Œè¿‡ç¨‹æœ‰æ›´å¤šå¯è§‚æµ‹æ€§çš„ç”¨æˆ·

## äº§å“æ„¿æ™¯

ä¸€ä¸ªè½»é‡çº§ TUI å·¥å…·ï¼Œåœ¨ç‹¬ç«‹ç»ˆç«¯çª—å£è¿è¡Œï¼Œä¸º Claude Code ç”¨æˆ·æä¾›ç±» Asana çš„ä»»åŠ¡çœ‹æ¿ä½“éªŒã€‚é»‘å®¢ç¾å­¦è®¾è®¡é£æ ¼ï¼Œé”®ç›˜é©±åŠ¨äº¤äº’ã€‚

## æ•°æ®æº

| æ¥æº | è·¯å¾„ | æ ¼å¼ | çŠ¶æ€ |
|---|---|---|---|
| TodoWriteï¼ˆæ—§ï¼‰ | `~/.claude/todos/{session}-agent-{agent}.json` | JSON æ•°ç»„ `[{content, status, activeForm}]` | âœ… å·²æ¥å…¥ |
| TaskCreateï¼ˆæ–°ï¼‰ | `~/.claude/tasks/{session}/{n}.json` | JSON å¯¹è±¡ `{id, subject, description, status, owner, blocks, blockedBy}` | âœ… å·²æ¥å…¥ |
| Session Index | `~/.claude/projects/*/sessions-index.json` | JSON `{entries: [{sessionId, projectPath, summary, gitBranch}]}` | âœ… å·²æ¥å…¥ |
| Session JSONL | `~/.claude/projects/*/{sessionId}.jsonl` | ä¼šè¯è®°å½• | âœ… ç”¨äº fallback åŒ¹é… + mtime æ´»è·ƒæ£€æµ‹ |
| Git HEAD | `{projectPath}/.git/HEAD` | å½“å‰åˆ†æ”¯ | âœ… å·²æ¥å…¥ |
| é¡¹ç›®æ–‡æ¡£ | `{projectPath}/CLAUDE.md`, `PRD.md`, `TDD.md`, `README.md` | å­˜åœ¨æ€§æ£€æµ‹ | âœ… å·²æ¥å…¥ |
| æœ¬åœ°å¿«ç…§ | `~/.claude-monitor/snapshots/{sessionId}.json` | TUI è‡ªå·±çš„æŒä¹…åŒ–å‰¯æœ¬ | ğŸ”œ v0.2 |
| Team Config | `~/.claude/teams/{team}/config.json` | JSON `{members: [{name, agentId, agentType}]}` | ğŸ”œ v0.3 |
| Hook Events | Claude Code hook ç³»ç»Ÿ | äº‹ä»¶è§¦å‘ | ğŸ”œ v0.4 |
| è¿›ç¨‹çŠ¶æ€ | `ps` ç³»ç»Ÿè°ƒç”¨ | è¿›ç¨‹ä¿¡æ¯ | ğŸ”œ v0.3 |

## åŠŸèƒ½è§„åˆ’

### v0.1 â€” åŸºç¡€çœ‹æ¿ï¼ˆâœ… å·²å®Œæˆï¼‰

- [x] æ‰«æ `~/.claude/todos/` å’Œ `~/.claude/tasks/` ä¸¤å¥—å­˜å‚¨
- [x] ç»Ÿä¸€æ•°æ®æ¨¡å‹å±•ç¤ºï¼ˆTodoItem + TaskItem â†’ SessionDataï¼‰
- [x] 1 ç§’è½®è¯¢å®æ—¶åˆ·æ–° + snapshotKey æŒ‡çº¹å¯¹æ¯”ï¼ˆä»…æ•°æ®å˜åŒ–æ—¶ re-renderï¼‰
- [x] å¡ç‰‡å¼ session å±•ç¤ºï¼ˆstatus icon + è¿›åº¦ç»Ÿè®¡ + æ—¶é—´æˆ³ï¼‰
- [x] Ink (React for CLI) æ¸²æŸ“å¼•æ“
- [x] é¡¹ç›®åè§£æï¼šsessions-index.json åå‘ç´¢å¼• + jsonl fallback
- [x] Session æ‘˜è¦ / firstPrompt æ˜¾ç¤º
- [x] Git åˆ†æ”¯æ˜¾ç¤ºï¼ˆé main åˆ†æ”¯æ—¶ï¼‰
- [x] è¿›åº¦æ¡ï¼ˆæ¯ä¸ª session çš„å®Œæˆç™¾åˆ†æ¯”ï¼‰

### v0.2 â€” æŒä¹…åŒ– + äº¤äº’ + è®¾è®¡

#### æœ¬åœ°å¿«ç…§æŒä¹…åŒ–
- [ ] æ¯æ¬¡ poll å‘ç°æ–°æ•°æ®æ—¶ï¼Œå¿«ç…§åˆ° `~/.claude-monitor/snapshots/`
- [ ] Claude Code åˆ é™¤ task åï¼ŒTUI ä»ä¿ç•™å†å²è®°å½•
- [ ] å·²å®Œæˆ/å·²åˆ é™¤çš„ session é»˜è®¤æŠ˜å ä¸ºä¸€è¡Œï¼Œå¯å±•å¼€æŸ¥çœ‹

#### é”®ç›˜äº¤äº’
- [x] `â†‘` `â†“` / `j` `k`ï¼šåˆ‡æ¢ project/task ç„¦ç‚¹
- [x] `Enter`ï¼šè¿›å…¥é¡¹ç›®è¯¦æƒ…ï¼ˆProject Detail è§†å›¾ï¼‰
- [x] `Esc`ï¼šè¿”å›ä¸Šçº§è§†å›¾
- [x] `Tab`ï¼šåˆ‡æ¢åˆ° Kanban è§†å›¾
- [x] `Space`ï¼šæ ‡è®°é¡¹ç›®ï¼ˆâ˜‘/â˜ï¼‰ç”¨äº Kanban å¤šé€‰
- [ ] `/`ï¼šæœç´¢è¿‡æ»¤
- [ ] `f`ï¼šè¿‡æ»¤æ¨¡å¼ï¼ˆactive / all / projectï¼‰
- [x] `q`ï¼šé€€å‡º

#### è®¾è®¡é£æ ¼
- [x] é»‘å®¢ç¾å­¦ / cyberpunk ç»ˆç«¯é£æ ¼
- [x] Catppuccin Mocha é…è‰²æ–¹æ¡ˆï¼ˆ+ é¢„ç•™ Retro / Cyberpunk ä¸»é¢˜ï¼‰
- [ ] ASCII art header
- [x] Design Playground åŸå‹éªŒè¯
- [x] ç³»ç»ŸæŒ‡æ ‡çŠ¶æ€æ ï¼ˆCPU sparkline + MEM + ç½‘ç»œ + spinnerï¼‰
- [x] Mini mascotï¼ˆâ˜» çŠ¶æ€æŒ‡ç¤ºï¼Œå†…åµŒ status barï¼Œé™æ€æ— åŠ¨ç”»é¿å…é—ªçƒï¼‰

#### æ•°æ®æºé‡æ„
- [x] **é¡¹ç›®ä¸­å¿ƒåŒ–å‘ç°**ï¼šæ‰«æ `~/.claude/projects/` å…¨éƒ¨ç›®å½•ï¼ˆä¸ä¾èµ– tasks/todosï¼‰
- [x] **Git ä¿¡æ¯**ï¼šç›´æ¥è¯» `.git/HEAD` è·å–åˆ†æ”¯ï¼ˆéä»… sessions-index å…ƒæ•°æ®ï¼‰
- [x] **æ–‡æ¡£æ£€æµ‹**ï¼šæ£€æµ‹ CLAUDE.md, PRD.md, TDD.md, README.md å­˜åœ¨æ€§
- [x] **Session æ´»è·ƒæ£€æµ‹**ï¼šé€šè¿‡ `.jsonl` æ–‡ä»¶ mtime åˆ¤æ–­ï¼ˆ5 åˆ†é’Ÿé˜ˆå€¼ï¼‰
- [x] **è·¯å¾„åæ¨**ï¼š`resolveSegments()` ä» Claude ç¼–ç ç›®å½•åé‡å»ºå®é™…è·¯å¾„
- [x] **é¡¹ç›®å»é‡**ï¼šå¤šä¸ª Claude ç›®å½•è§£æåˆ°åŒä¸€è·¯å¾„æ—¶åˆå¹¶æ•°æ®
- [x] **Session å†å²**ï¼šä» sessions-index.json æå– summary/firstPrompt å±•ç¤º

#### è§†å›¾
- [x] **Dashboard è§†å›¾**ï¼ˆé»˜è®¤ï¼‰ï¼šOVERVIEW + ACTIVE NOW + PROJECTS(42) + ACTIVITY
- [x] **Project Detail è§†å›¾**ï¼šé¡¹ç›®ä¿¡æ¯ï¼ˆgit/path/sessions/docsï¼‰+ Tasks æˆ– Session å†å²
- [x] **Focus/Kanban è§†å›¾**ï¼šSwimlane è¡¨æ ¼å¸ƒå±€ï¼ˆå…±äº«è¡¨å¤´ TODO/DOING/DONEï¼‰
- [x] **æ´»è·ƒé¡¹ç›®ç½®é¡¶**ï¼šæœ‰ active session çš„é¡¹ç›®æ’åœ¨æœ€å‰
- [ ] **Project Detail ä¸‰æ **ï¼šTasks + Git History + PRD/Docs å¹¶æ’æ˜¾ç¤ºï¼ˆè®¾è®¡å·²æœ‰ï¼Œå¾…å®ç°ï¼‰
- [ ] **By Agent å¸ƒå±€**ï¼šKanban æŒ‰ agent åˆ†åˆ—ï¼ˆè®¾è®¡å·²æœ‰ï¼Œå¾…å®ç°ï¼‰
- [ ] **æŠ˜å /å±•å¼€**ï¼šæ—§ session æŠ˜å æˆå•è¡Œæ‘˜è¦

#### æ€§èƒ½ä¼˜åŒ–
- [x] **æ¸²æŸ“é¢‘ç‡é™ä½**ï¼šmetrics 3s/æ¬¡ï¼ˆç½‘ç»œ 6sï¼‰ï¼Œæ•°æ®è½®è¯¢ 3s
- [x] **é¡ºåºå¼‚æ­¥å¾ªç¯**ï¼šwhile + await æ›¿ä»£ setIntervalï¼Œé˜²æ­¢ netstat è¿›ç¨‹ç´¯ç§¯
- [x] **StatusBar æ¸²æŸ“éš”ç¦»**ï¼šuseMetrics() åœ¨ StatusBar å†…éƒ¨ï¼Œä¸ä¼ æ’­åˆ° App
- [x] **å›ºå®šå®½åº¦æ ¼å¼åŒ–**ï¼šæ•°å€¼ padStart é˜²æ­¢ layout shift
- [x] **snapshotKey å·®å¼‚æ£€æµ‹**ï¼šä»…æ•°æ®å˜åŒ–æ—¶è§¦å‘ React re-render
- [x] **Production æ„å»º**ï¼šNODE_ENV=production æŠ‘åˆ¶ React dev è­¦å‘Š

### v0.3 â€” å¤š Agent ç›‘æ§

- [ ] **Team æ¨¡å¼æ”¯æŒ**ï¼šè¯»å– `~/.claude/teams/` é…ç½®ï¼ŒæŒ‰ team åˆ†ç»„å±•ç¤º
- [ ] **Agent æ ‡è¯†**ï¼šæ˜¾ç¤º task ownerï¼ˆå“ªä¸ª agent åœ¨åšå“ªä¸ªä»»åŠ¡ï¼‰
- [ ] **ä¾èµ–å¯è§†åŒ–**ï¼šæ˜¾ç¤º `blocks` / `blockedBy` å…³ç³»
- [ ] **è¿›ç¨‹çŠ¶æ€**ï¼šæ£€æµ‹ agent è¿›ç¨‹æ˜¯å¦å­˜æ´»ï¼ˆrunning / idle / deadï¼‰

### v0.4 â€” äº‹ä»¶æµé›†æˆ

- [ ] **Hook äº‹ä»¶æ¥æ”¶**ï¼šæ¥å…¥ Claude Code hook ç³»ç»Ÿï¼Œå®æ—¶æ˜¾ç¤ºäº‹ä»¶æµ
- [ ] **äº‹ä»¶æ—¶é—´çº¿**ï¼šåº•éƒ¨é¢æ¿æ˜¾ç¤ºæœ€è¿‘çš„ hook äº‹ä»¶ï¼ˆstart, submit, complete, error...ï¼‰
- [ ] **ä¸ Sound FX è”åŠ¨**ï¼šå…±äº« hook åŸºç¡€è®¾æ–½ï¼ˆåŒä¸€ä¸ª event collectorï¼‰

### v0.5 â€” åŠ¨æ•ˆä¸æ¶¦è‰²

- [ ] **Phase 1 å¾®åŠ¨æ•ˆ**ï¼šæ´»è·ƒ task è„‰å†²é—ªçƒã€æ–° task é«˜äº® flashã€æ•°å­—æ»šåŠ¨
- [ ] **Phase 2 è¿‡æ¸¡æ•ˆæœ**ï¼šè§†å›¾åˆ‡æ¢æ·¡å…¥æ·¡å‡ºã€è¿›åº¦æ¡åŠ¨ç”»
- [ ] **Phase 3 è§’è‰²åŠ¨ç”»**ï¼ˆstretch goalï¼‰ï¼šmascot æ°´å¹³è·‘åŠ¨ã€è·å–æ•°æ®å†²æ’ç‰¹æ•ˆã€è·³è·ƒ/æ‰è½
- [ ] **å¯å±•å¼€æŒ‡æ ‡é¢æ¿**ï¼šæŒ‰ `m` å±•å¼€ braille æŠ˜çº¿å›¾ï¼ˆCPU/MEM/NET 1 åˆ†é’Ÿå†å²ï¼‰
- [ ] **å¤šå¥—ä¸»é¢˜åˆ‡æ¢**ï¼šCatppuccin Mocha / Retro Terminal / Cyberpunkï¼Œ`t` é”®æˆ– CLI flag

### æœªæ¥è€ƒè™‘ï¼ˆä¸æ‰¿è¯ºæ—¶é—´ï¼‰

- [ ] Web ç‰ˆæœ¬ï¼ˆlocalhost dashboardï¼‰
- [ ] å†å²ç»Ÿè®¡ï¼ˆæ¯æ—¥å®Œæˆä»»åŠ¡æ•°ã€å¹³å‡ session æ—¶é•¿ï¼‰
- [ ] Claude Code æ’ä»¶é›†æˆï¼ˆä½œä¸º MCP resource æä¾›æ•°æ®ï¼‰
- [ ] é€šçŸ¥é›†æˆï¼ˆtask blocked æ—¶å‘é€ç³»ç»Ÿé€šçŸ¥ï¼‰

## æŠ€æœ¯æ ˆ

| å±‚ | é€‰å‹ | ç†ç”± |
|---|---|---|
| è¯­è¨€ | TypeScript | é¡¹ç›®è§„èŒƒ + ç±»å‹å®‰å…¨ |
| TUI å¼•æ“ | Ink (React for CLI) | å“åº”å¼æ¸²æŸ“ï¼Œç»„ä»¶åŒ–å¼€å‘ |
| æ•°æ®åˆ·æ–° | 3s setInterval è½®è¯¢ + snapshotKey diff | æ¯” Chokidar FSEvents æ›´å¯é ï¼Œä»…å˜åŒ–æ—¶ re-render |
| æŒä¹…åŒ– | JSON æ–‡ä»¶ (`~/.claude-monitor/`) | æœ¬åœ°å¿«ç…§ï¼Œæ— éœ€æ•°æ®åº“ |
| æ„å»º | tsup | é›¶é…ç½® TS æ‰“åŒ… |
| å¼€å‘ | tsx | TS ç›´æ¥è¿è¡Œï¼Œæ— éœ€ç¼–è¯‘ |
| åŒ…ç®¡ç† | npm | é¡¹ç›®é»˜è®¤ |

## äº¤äº’æ¨¡å‹

### é”®ç›˜é©±åŠ¨ï¼ˆä¸»è¦ï¼‰

TUI çš„äº¤äº’æ¨¡å‹ç±»ä¼¼ vim / htop / lazygitï¼š

```
å…¨å±€å¿«æ·é”®ï¼š
  q         é€€å‡º
  /         æœç´¢
  Tab       åˆ‡æ¢è§†å›¾
  f         è¿‡æ»¤

å¯¼èˆªï¼š
  â†‘/k       ä¸Šç§»ç„¦ç‚¹
  â†“/j       ä¸‹ç§»ç„¦ç‚¹
  Enter     å±•å¼€/æŠ˜å 
  Esc       è¿”å›ä¸Šçº§
```

### Ink æä¾›çš„äº¤äº’ Hook

```typescript
useInput()       // æ•è·é”®ç›˜è¾“å…¥
useFocus()       // ç»„ä»¶ç„¦ç‚¹ç®¡ç†
useFocusManager() // å…¨å±€ç„¦ç‚¹å¯¼èˆª
```

### é¼ æ ‡ï¼ˆè¾…åŠ©ï¼Œä¸ä¾èµ–ï¼‰

ç»ˆç«¯æ”¯æŒé¼ æ ‡æŠ¥å‘Šåè®®ï¼Œä½†ä¸åŒç»ˆç«¯å…¼å®¹æ€§å·®å¼‚å¤§ï¼Œä¸ä½œä¸ºä¸»è¦äº¤äº’æ–¹å¼ã€‚

## çº¦æŸä¸é™åˆ¶

### Claude Code çš„é™åˆ¶

1. **æ— å…¬å¼€ Agent çŠ¶æ€ API** â€” æ— æ³•è·çŸ¥ agent æ˜¯åœ¨ "è§„åˆ’" è¿˜æ˜¯ "æ‰§è¡Œ"ï¼Œåªèƒ½é€šè¿‡ task status é—´æ¥æ¨æ–­
2. **Hook äº‹ä»¶ç²’åº¦æœ‰é™** â€” åªæœ‰ 7 ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæ— æ³•è¿½è¸ªæ¯æ¬¡å·¥å…·è°ƒç”¨
3. ~~**æ²¡æœ‰ session ID åˆ°é¡¹ç›®çš„æ˜ å°„**~~ â€” âœ… å·²è§£å†³ï¼š`sessions-index.json` + jsonl fallback
4. ~~**TodoWrite å’Œ TaskCreate å¹¶å­˜**~~ â€” âœ… å·²ç»Ÿä¸€ï¼šä¸¤å¥—æ ¼å¼é€šè¿‡ SessionData æŠ½è±¡å±‚åˆå¹¶å±•ç¤º
5. **Task åˆ é™¤åæ–‡ä»¶æ¶ˆå¤±** â€” ğŸ”œ v0.2 æœ¬åœ°å¿«ç…§è§£å†³

### è®¾è®¡åŸåˆ™

- **åªè¯»** â€” ä¸ä¿®æ”¹ä»»ä½• Claude Code çš„æ•°æ®æ–‡ä»¶
- **éä¾µå…¥** â€” ä¸éœ€è¦ä¿®æ”¹ Claude Code é…ç½®ï¼Œå¼€ç®±å³ç”¨
- **è½»é‡** â€” ç‹¬ç«‹ç»ˆç«¯çª—å£è¿è¡Œï¼Œä¸å½±å“ Claude Code æ€§èƒ½
- **æ¸è¿›å¢å¼º** â€” æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹å¯ç”¨ï¼Œä¸ä¾èµ–æœªå®ç°çš„åŠŸèƒ½
- **é”®ç›˜ä¼˜å…ˆ** â€” æ‰€æœ‰æ“ä½œå¯é€šè¿‡é”®ç›˜å®Œæˆ

## ä½¿ç”¨æ–¹å¼

```bash
# åŸºç¡€ç”¨æ³•ï¼šåœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡Œ
npx tsx src/index.tsx

# æœªæ¥ï¼šå…¨å±€å®‰è£…
npm install -g claude-monitor
claude-monitor

# æœªæ¥ï¼šå¸¦å‚æ•°
claude-monitor --filter active      # åªçœ‹æ´»è·ƒ session
claude-monitor --view kanban        # çœ‹æ¿è§†å›¾
claude-monitor --team my-project    # åªçœ‹æŸä¸ª team
```
